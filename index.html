<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Encuentro Ideal</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Encuentro Ideal üåç</h1>

  <div class="centrar">
    <img src="avion3.jpg" alt="Imagen de un avi√≥n" width = "300" height = "100">
  </div>
  

  <form id="preferenciasForm">
    <label for="nombre">Tu nombre:</label>
    <input type="text" id="nombre" required><br><br>

    <label for="edad">Tu edad:</label>
    <input type="number" id="number" min="0" required><br><br>

    <label for="origen">¬øDesde qu√© ciudad viajas? (C√≥digo IATA, ej: MAD para Madrid):</label>
    <input type="text" id="origen" maxlength="3" required><br><br>

    <label>¬øQu√© prefieres?</label><br>
    <select id="tipoLugar" required>
      <option value="">--Selecciona--</option>
      <option value="playa">Playa</option>
      <option value="cultura">Cultura</option>
      <option value="naturaleza">Naturaleza</option>
      <option value="ciudad">Ciudad</option>
    </select><br><br>

    <label>¬øTu presupuesto?</label><br>
    <select id="presupuesto" required>
      <option value="">--Selecciona--</option>
      <option value="bajo">Bajo</option>
      <option value="medio">Medio</option>
      <option value="alto">Alto</option>
    </select><br><br>

    <label for="fecha">Fecha de salida (YYYY-MM-DD):</label>
    <input type="date" id="fecha" required><br><br>

    <button type="submit">Buscar destinos ‚úàÔ∏è</button>
  </form>

  <div id="resultados"></div>
  <script>
    document.getElementById("preferenciasForm").addEventListener("submit", async (event) => {
      event.preventDefault(); // Evita que el formulario recargue la p√°gina
  
      try {
        console.log("Siguiente paso");
        const response = await fetch("http://localhost:3000/buscar", {
          method: "POST", // Solo env√≠a la solicitud sin cuerpo
        });
  
        console.log("Respuesta del servidor:", response); // Verifica si hay respuesta
  
        // Procesa la respuesta del servidor
        const resultados = await response.json();
        console.log("Resultados procesados:", resultados); // Imprime el JSON en la consola

      // Extraer itinerarios y aerol√≠neas
      const itinerarios = resultados.content.results.itineraries;
      const carriers = resultados.content.results.carriers;

      // Procesar los itinerarios
      const vuelos = Object.keys(itinerarios).map((id) => {
        const itinerario = itinerarios[id];
        const precio = itinerario.pricingOptions[0].price.amount / 1000; // Convertir de miliprecios a precios normales
        const aerolineaId = itinerario.pricingOptions[0].agentIds[0];
        const aerolinea = carriers[aerolineaId]?.name || "Desconocida";

        return {
          id,
          precio,
          aerolinea,
        };
      });

      console.log("Vuelos procesados:", vuelos);

      // Mostrar los resultados en la p√°gina
      const resultadosDiv = document.getElementById("resultados");
      resultadosDiv.innerHTML = "<h2>Resultados de vuelos:</h2>";

      if (vuelos.length === 0) {
        resultadosDiv.innerHTML += "<p>No se encontraron vuelos.</p>";
        return;
      }

      const lista = document.createElement("ul");
      vuelos.forEach((vuelo) => {
        const item = document.createElement("li");
        item.innerHTML = `<strong>Aerol√≠nea:</strong> ${vuelo.aerolinea} - <strong>Precio:</strong> ${vuelo.precio} ‚Ç¨`;
        lista.appendChild(item);
      });

      resultadosDiv.appendChild(lista);


        //////
      } catch (error) {
        console.error("Error al buscar vuelos:", error);
      }
    });
  </script>
</body>
</html>
